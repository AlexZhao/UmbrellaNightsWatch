{
    "audit_log_path" : "/var/log/runtime_mon.log",
    "audit_log_enabled" : true, 

    "topics": {
        "net_connect" : {
            "app":"str",
            "pid":"int",
            "type": "str",
            "target_ip":"str",
            "timestamp":"str"
        },
        "file_open" : {
            "app":"str",
            "pid":"int",
            "file":"str",
            "timestamp":"str"
        },
        "dev_operate": {
            "app":"str",
            "pid":"int",
            "dev":"str",
            "timestamp":"str"
        },
        "kmod": {
            "app": "str"
        },
        "seldom_syscall": {
            "app": "str",
            "pid": "int",
            "timestamp": "str",
            "syscall": "str"
        },
        "execv": {
            "app": "str",
            "pid": "int",
            "bin": "str",
            "params": "str"
        }
    },

    "umbrella_prb": {
        "net_prb": {
            "ebpf": "./ebpf/ebpf_prb_net.c",
            "providers": {
                "sys_enter_connect": {
                    "topic": "net_connect",
                    "map": {
                        "2": "timestamp",
                        "3": "app",
                        "4": "pid",
                        "5": "type",
                        "6": "target_ip"
                    }
                },
                "sys_enter_sendto": {
                    "topic": "net_connect",
                    "map": {
                        "2": "timestamp",
                        "3": "app",
                        "4": "pid",
                        "5": "type",
                        "6": "target_ip"
                    }
                }
            }
        },
        "file_prb": {
            "ebpf": "./ebpf/ebpf_prb_file_access.c",
            "providers": {
                "sys_enter_open": {
                    "topic": "file_open"
                },
                "sys_enter_openat": {
                    "topic": "file_open",
                    "map": {
                        "2": "timestamp",
                        "3": "app",
                        "4": "pid",
                        "5": "file"
                    }
                },
                "sys_enter_openat2": {
                    "topic": "file_open"
                }
            }
        },
        "module_prb": {
            "ebpf": "./ebpf/ebpf_prb_mod_op.c",
            "providers": {
                "module_load": {
                    "topic": "kmod"
                }
            }
        },
        "seldom_syscall_prb": {
            "ebpf": "./ebpf/ebpf_prb_seldom_syscall.c",
            "providers": {
                "sys_enter_ptrace": {
                    "topic": "seldom_syscall",
                    "map": {
                        "2": "timestamp",
                        "3": "app",
                        "4": "pid",
                        "5": "syscall"                        
                    }
                },
                "sys_enter_modify_ldt": {
                    "topic": "seldom_syscall",
                    "map": {
                        "2": "timestamp",
                        "3": "app",
                        "4": "pid",
                        "5": "syscall"                        
                    }
                },
                "sys_enter_personality": {
                    "topic": "seldom_syscall",
                    "map": {
                        "2": "timestamp",
                        "3": "app",
                        "4": "pid",
                        "5": "syscall"                        
                    }
                },
                "sys_enter_arch_prctl": {
                    "topic": "seldom_syscall",
                    "map": {
                        "2": "timestamp",
                        "3": "app",
                        "4": "pid",
                        "5": "syscall"                        
                    }
                }
            }
        },
        "execve_prb": {
            "ebpf": "./ebpf/ebpf_prb_execv.c",
            "providers": {
                "sys_enter_execve": {
                    "topic": "execv",
                    "map": {
                        "3": "app",
                        "4": "pid",
                        "5": "bin",
                        "6:": {
                            "key":"params",
                            "sep": " "
                        }
                    }
                },
                "sys_enter_execveat": {
                    "topic": "execv",
                    "map": {
                        "3": "app",
                        "4": "pid",
                        "5": "bin",
                        "6:": {
                            "key": "params",
                            "sep": " "
                        }
                    }
                }
            }
        }
    },

    "umbrella_pkt": {
        "dns_pkt": {
            "ebpf": "./ebpf/ebpf_pkt_dns.c",
            "pkt_parsers": [
                {
                    "pkt_parser": "xdp_dns_filter",
                    "pkt_type": "xdp",
                    "interfaces": [ 
                        "lo",
                        "enp2s0",
                        "wlp1s0" 
                    ]
                },
                {
                    "pkt_parser": "cls_dns_filter",
                    "pkt_type": "classifier",
                    "interfaces": [
                        "wlp1s0"
                    ]
                }
            ],
            "pkt_outputs": [
                {"perf_output": "pkts"}
            ],
            "log": {
                "file": "/var/log/nw_dns_pkt.log",
                "flush_threshold": 1
            }
        }
    },

    "umbrella_lsm": {
        "net_lsm": { 
            "ebpf": "./ebpf/ebpf_lsm_net.c",
            "config_maps": [
                "host_ipv4_allow_list",
                "host_ipv6_allow_list",
                "app_ipv4_strict_access_list",
                "app_ipv6_strict_access_list",
                "tcp_allowed_high_port",
                "udp_allowed_high_port",
                "tcp_allowed_ephemeral_port_listen"
            ],
            "configs": {
                "host_ipv4_allow_list": {
                    "key_convert": "str2ip",
                    "val_convert": "str2int",
                    "config_pairs": {
                        "10.22.0.0/16": "1",
                        "10.96.0.0/16": "1",
                        "192.168.10.0/24": "1",
                        "127.0.0.0/24": "1",
                        "192.168.1.0/24": "1",
                        "0.0.0.0/0": "1"
                    }
                },
                "host_ipv6_allow_list" : {
                    "key_convert": "str2ip",
                    "val_convert": "str2int",
                    "config_pairs": {
                        "::1/112": "1"
                    }
                },
                "ipv4_allow_list": {
                    "key_convert": "str2ip",
                    "val_convert": "str2int",
                    "config_pairs": {
                        "127.0.0.1": "1",
                        "192.168.10.1": "1",
                        "0.0.0.0/0": "1"
                    }
                },
                "ipv4_allow_list_internal": {
                    "key_convert": "str2ip",
                    "val_convert": "str2int",
                    "config_pairs": {
                        "127.0.0.1": "1"
                    }
                },
                "app_ipv4_strict_access_list": {
                    "key_convert": "str2taskinfo",
                    "val_convert": "str2mapfd",
                    "config_pairs": {
                        "code": "ipv4_allow_list_internal",
                        "firefox": "ipv4_allow_list",
                        "systemd": "ipv4_allow_list",
                        "gnome-shell": "ipv4_allow_list",
                        "curl": "ipv4_allow_list_internal",
                        "bash": "ipv4_allow_list"
                    }
                },
                "tcp_allowed_ephemeral_port_listen": {
                    "key_convert": "str2taskinfo",
                    "val_convert": "str2int",
                    "config_pairs": {
                        "containerd": "1"
                    }
                },
                "tcp_allowed_high_port": {
                    "key_convert": "str2u16",
                    "val_convert": "str2taskinfo",
                    "config_pairs": {
                        "6443": "kube-apiserver",
                        "10259": "kube-scheduler",
                        "10257": "kube-controller",
                        "2379": "etcd",
                        "2380": "etcd",
                        "2381": "etcd",
                        "10248": "kubelet",
                        "10250": "kubelet",
                        "10256": "kube-proxy",
                        "10249": "kube-proxy",
                        "40217": "containerd",
                        "8181": "coredns",
                        "8080": "coredns",
                        "8277": "python3.11"
                    }
                }
            },
            "log": {
                "file": "/var/log/nw_net_lsm.log"
            },
            "providers": {
                "unix_may_send": {
                    "topic": "net_access"
                }
            }
        },
        "bpf_lsm": {
            "ebpf": "ebpf_shield",
            "persist_shield": true
        },
        "uring_lsm": {
            "ebpf": "./ebpf/ebpf_lsm_uring.c",
            "providers": {

            }
        },
        "exec_lsm": {
            "ebpf": "./ebpf/ebpf_lsm_exec.c",
            "config_maps": [
                "app_block_list",
                "initiate_task_list",
                "initiate_task_list_1",
                "app_allow_list"
            ],
            "configs": {
                "app_block_list": {
                    "key_convert": "str2taskinfo",
                    "val_convert": "str2int",
                    "config_pairs": {
                        "packagekitd": "1",
                        "fprintd": "1"
                    }
                },
                "initiate_task_list": {
                    "key_convert": "str2taskinfo",
                    "val_convert": "str2int",
                    "config_pairs": {
                        "gnome-terminal-server": "1",
                        "bash": "1",
                        "sudo": "1",
                        "man.man-db": "1",
                        "gio-launch-desk": "1",
                        "abrt-handle-eve": "1"
                    }
                },
                "app_allow_list": {
                    "key_convert": "str2taskinfo",
                    "val_convert": "str2mapfd",
                    "config_pairs": {
                        "bash": "initiate_task_list"
                    }
                }
            },
            "providers": {

            },
            "log": {
                "file": "/var/log/nw_exec_lsm.log"
            }
        },
        "kmod_lsm": {
            "ebpf": "./ebpf/ebpf_lsm_kmod.c",
            "config_sets": {
                "allow_mod_list": {
                    "i915": "1",
                    "nvme": "1",
                    "r8169": "1",
                    "xfs": "1",
                    "binfmt_misc": "1",
                    "video": "1",
                    "snd_hrtimer": "1",
                    "nf_conntrack_netbios_ns": "1",
                    "nf_conntrack_broadcast": "1",
                    "nft_fib_inet": "1",
                    "nft_fib_ipv4": "1",
                    "nft_fib_ipv6": "1",
                    "nft_fib": "1",
                    "nft_reject_inet": "1",
                    "nf_reject_ipv4": "1",
                    "nf_reject_ipv6": "1",
                    "nft_reject": "1",
                    "nft_chain_nat": "1",
                    "nft_ct": "1",
                    "nf_nat": "1",
                    "nf_conntrack": "1",
                    "nf_defrag_ipv6": "1",
                    "nf_defrag_ipv4": "1",
                    "nf_tables": "1",
                    "nfnetlink": "1",
                    "qrtr": "1",
                    "bnep": "1",
                    "sunrpc": "1",
                    "binfmt_misc": "1",
                    "vfat": "1",
                    "fat": "1",
                    "snd_hda_codec_hdmi": "1",
                    "snd_hda_codec_realtek": "1",
                    "snd_hda_codec_generic": "1",
                    "ledtrig_audio": "1",
                    "snd_hda_intel": "1",
                    "snd_intel_dspcfg": "1",
                    "snd_intel_sdw_acpi": "1",
                    "snd_hda_codec": "1",
                    "snd_hda_core": "1",
                    "snd_hwdep": "1",
                    "snd_seq": "1",
                    "snd_seq_device": "1",
                    "snd_pcm": "1",
                    "snd_timer": "1",
                    "bluetooth": "1",
                    "snd": "1",
                    "soundcore": "1",
                    "rfkill": "1",
                    "zram": "1",
                    "crct10dif_pclmul": "1",
                    "drm_buddy": "1",
                    "crc32c_intel": "1",
                    "drm_display_helper": "1",
                    "cec": "1",
                    "nvme_core": "1",
                    "mmc_core": "1",
                    "nvme_common": "1",
                    "ttm": "1",
                    "wmi": "1",
                    "fuse": "1",
                    "usb_storage": "1",
                    "usb-storage": "1",
                    "irqbypass": "1",
                    "kvm": "1",
                    "kvm_intel": "1",
                    "llc": "1",
                    "vhost_net": "1",
                    "vhost": "1",
                    "vhost_iotlb": "1",
                    "tap": "1",
                    "tun": "1",
                    "xt_CHECKSUM": "1",
                    "xt_MASQUERADE": "1",
                    "xt_conntrack": "1",
                    "ipt_REJECT": "1",
                    "nft_compat": "1",
                    "nf_nat_tftp": "1",
                    "nf_conntrack_tftp": "1",
                    "bridge": "1",
                    "stp": "1",
                    "br_netfilter": "1",
                    "nf_conntrack_netlink": "1",
                    "xt_addrtype": "1",
                    "veth": "1",
                    "xt_nat": "1",
                    "overlay": "1",
                    "cfg80211": "1",
                    "mac80211": "1",
                    "rtw88_core": "1",
                    "rtw88_pci": "1",
                    "rtw88_8821c": "1",
                    "rtw88_8821ce": "1",
                    "cls_bpf": "1",
                    "sch_sfq": "1"
                }
            },
            "operation": {
                "setup": [
                    {
                        "kmod": {
                            "unload_no_ref_kmod": "allow_mod_list"
                        }
                    }
                ]
            },
            "config_maps": [
                "allow_kmod_list",
                "allow_attach_dev_list"
            ],
            "configs": {
                "allow_kmod_list": {
                    "key_convert": "str2kmod",
                    "val_convert": "str2int",
                    "config_pairs": "allow_mod_list"
                },
                "allow_attach_dev_list": {
                    "key_convert": "str2kmod",
                    "val_convert": "str2int",
                    "config_pairs": {
                        "netdev": "1"
                    }
                }
            },
            "providers": {

            },
            "log": {
                "file": "/var/log/nw_kmod_lsm.log"
            }
        },
        "mount_lsm": {
            "ebpf": "./ebpf/ebpf_lsm_mount.c",
            "providers": {

            },
            "log": {
                "file": "/var/log/nw_mount_lsm.log"
            }
        },
        "ipc_lsm": {
            "ebpf": "./ebpf/ebpf_lsm_ipc.c",
            "providers": {

            },
            "log": {
                "file": "/var/log/nw_ipc_lsm.log"
            }
        }
    },

    "analyst": {
        "nw_endpoint": "http://127.0.0.1:8277",
        
        "app_profile": {
            "consumers": { 
                "net_connect": "update_net_access",
                "file_open": "update_file_access",
                "dev_operate": "update_dev_access",
                "execv": "update_execv_access",
                "seldom_syscall": "update_seldom_syscall"
            }
        },

        "prophet_analysis": {
            "prophet_endpint": "https://192.168.10.250:",
            "prophet_syslog": "192.168.10.250",
            "consumers": {
                "net_connect": "analysis_net_access"
            }
        }
    },

    "ld_bindings_audit": {
        "log_path": "/var/log/ld-linux/"
    }
}
